Excellent follow-up questions. These are **exactly the right concerns** when youâ€™re building a serious Terraform approval workflow.

Iâ€™ll answer this in **two big sections**, very clearly and practically:

---

# PART 1ï¸âƒ£ â€” More powerful `$GITHUB_STEP_SUMMARY` examples

(including *â€œclick moreâ€* behavior)

---

## ğŸ”¹ Important limitation (must know first)

> â— **GitHub Step Summary does NOT support collapsible â€œclick-to-expandâ€ sections natively**

There is:

* âŒ no `<details>` support
* âŒ no JavaScript
* âŒ no true â€œShow moreâ€ button

Butâ€¦
ğŸ‘‰ **We can achieve the same UX using safe, supported patterns**.

Iâ€™ll show you **3 production-grade patterns** teams actually use.

---

## âœ… Pattern A (BEST): Summary + Artifact (recommended by GitHub)

This is the **officially recommended** and most audit-friendly approach.

### What the approver sees

* Short readable plan preview in Summary
* Full plan downloadable as artifact

### Why this works

* Summary stays readable
* Full plan is one click away
* No UI hacks

### Example

````bash
echo "## Terraform Plan Review" >> $GITHUB_STEP_SUMMARY
echo "" >> $GITHUB_STEP_SUMMARY
echo "### Summary" >> $GITHUB_STEP_SUMMARY
echo "- Environment: Development" >> $GITHUB_STEP_SUMMARY
echo "- Action: APPLY" >> $GITHUB_STEP_SUMMARY
echo "" >> $GITHUB_STEP_SUMMARY

echo "### Plan Preview (first 50 lines)" >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY
head -n 50 terraform-plan.txt >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY

echo "" >> $GITHUB_STEP_SUMMARY
echo "â¡ï¸ **Download full plan from Artifacts â†’ terraform-plan**" >> $GITHUB_STEP_SUMMARY
````

ğŸ’¡ This is what **most Fortune-500 Terraform pipelines do**.

---

## âœ… Pattern B: â€œLogical Click Moreâ€ using links

You can **simulate â€œclick moreâ€** by linking to:

* Artifact
* Another job
* Another run URL

### Example

```bash
echo "### Full Plan" >> $GITHUB_STEP_SUMMARY
echo "[Click here to download full Terraform plan](#artifacts)" >> $GITHUB_STEP_SUMMARY
```

GitHub automatically anchors `#artifacts` to the artifact section.

---

## âœ… Pattern C: Split summary into sections (safe & clean)

Instead of dumping the full plan, you show:

* Adds
* Changes
* Deletes
* Risks

### Generate categorized output

```bash
terraform show -no-color tfplan.binary > terraform-plan.txt

grep "^  +" terraform-plan.txt > adds.txt || true
grep "^  ~" terraform-plan.txt > changes.txt || true
grep "^  -" terraform-plan.txt > deletes.txt || true
```

### Publish clean summary

````bash
echo "## Terraform Change Summary" >> $GITHUB_STEP_SUMMARY

echo "### Resources to be CREATED" >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY
head -n 20 adds.txt >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY

echo "### Resources to be UPDATED" >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY
head -n 20 changes.txt >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY

echo "### Resources to be DELETED âš ï¸" >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY
cat deletes.txt >> $GITHUB_STEP_SUMMARY
echo '```' >> $GITHUB_STEP_SUMMARY
````

ğŸ”¥ This looks *very* senior in reviews.

---

## â“ Can we show the COMPLETE plan inline?

### Technically: yes

### Practically: **do NOT**

Reasons:

* Summary UI becomes slow
* Hard to review
* GitHub truncates very large content
* Leads hate scrolling 10k lines

ğŸ‘‰ **Artifact is the correct place for full plan**

---

# PART 2ï¸âƒ£ â€” Skip APPLY when Terraform plan has NO changes

(this is a BIG one)

Your second question is **architecturally critical**:

> *â€œHow to discard apply step if there are no changes?â€*

This is **exactly how Terraform pipelines should behave**.

---

## ğŸ”¹ Key Terraform behavior

Terraform returns **exit codes**:

| Command                             | Exit Code | Meaning         |
| ----------------------------------- | --------- | --------------- |
| `terraform plan`                    | `0`       | No changes      |
| `terraform plan -detailed-exitcode` | `2`       | Changes present |
| `terraform plan -detailed-exitcode` | `1`       | Error           |

ğŸ‘‰ We use this to control flow.

---

## âœ… Correct way: use `-detailed-exitcode`

### Plan step (IMPORTANT)

```yaml
- name: Terraform Plan
  id: plan
  run: |
    terraform init
    terraform plan -detailed-exitcode -out=tfplan.binary
  continue-on-error: true
```

---

### Capture whether changes exist

```yaml
- name: Set plan result
  id: plan_result
  run: |
    if [ "${{ steps.plan.outcome }}" = "success" ]; then
      echo "changes=false" >> $GITHUB_OUTPUT
    else
      echo "changes=true" >> $GITHUB_OUTPUT
    fi
```

---

## âœ… Skip APPLY job automatically

### Apply job condition

```yaml
Terraform_Apply:
  needs: Terraform_Plan
  if: needs.Terraform_Plan.outputs.changes == 'true'
```

ğŸ’¥ If no changes â†’ **Apply job never starts**
ğŸ’¥ No approval prompt
ğŸ’¥ Clean UI

---

## âœ… Publish â€œNo Changesâ€ summary

```bash
if terraform plan -detailed-exitcode -out=tfplan.binary; then
  echo "## Terraform Plan Result" >> $GITHUB_STEP_SUMMARY
  echo "âœ… No infrastructure changes detected." >> $GITHUB_STEP_SUMMARY
  exit 0
fi
```

Your lead will see:

> âœ… No changes detected â€“ approval not required

---

## ğŸ¯ Final recommended behavior (what you want)

| Scenario             | What happens                |
| -------------------- | --------------------------- |
| No changes           | Apply skipped automatically |
| Only creates/updates | Approval required           |
| Deletes detected     | Approval + warning          |
| Plan error           | Pipeline fails              |

This is **gold-standard Terraform CI/CD**.

---

## How to explain this to your lead (short & crisp)

> â€œWe use Terraformâ€™s detailed exit codes to automatically skip apply when there are no changes. The plan summary is published directly in the GitHub approval view, and the full plan is attached as an artifact for deeper review.â€

That sentence alone puts you in **senior-engineer territory**.

---

## If you want next

I can help you add:

* ğŸš¨ **Fail if deletes exist in prod**
* ğŸ’° **Cost estimation in summary**
* ğŸ§ª **Policy checks before approval**
* ğŸ” **Signed plan validation**

Just say the word.
