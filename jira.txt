Perfect ğŸ‘
You want **Option B (Enterprise-style module)**
But:

* âŒ No CMEK
* âŒ No IAM bindings
* âœ… Support multiple repos
* âœ… Support cleanup policies
* âœ… Follow your exact GCS module pattern
* âœ… Use for_each + map(object())
* âœ… Driven by tfvars

Good. Letâ€™s design this cleanly.

---

# ğŸ¯ What This Module Will Support

Using Terraform, we will support:

* Multiple repositories
* Different formats (DOCKER, MAVEN, PYTHON, etc.)
* Labels
* Description
* Cleanup policies
* Regional location
* Environment naming via tfvars

---

# ğŸ“ Folder Structure (Same Pattern As GCS & PubSub)

```
modules/
  artifactregistry/
    main.tf
    variables.tf
    outputs.tf
```

---

# ================================

# ğŸ“ modules/artifactregistry/main.tf

# ================================

```hcl
resource "google_artifact_registry_repository" "this" {
  for_each = var.repositories

  repository_id = each.key
  project       = var.project_id
  location      = each.value.location
  format        = each.value.format
  description   = each.value.description

  labels = each.value.labels

  dynamic "cleanup_policies" {
    for_each = each.value.cleanup.enabled ? [1] : []
    content {
      id     = each.value.cleanup.policy_id
      action = each.value.cleanup.action

      condition {
        older_than            = each.value.cleanup.older_than
        tag_state             = each.value.cleanup.tag_state
        tag_prefixes          = each.value.cleanup.tag_prefixes
        package_name_prefixes = each.value.cleanup.package_name_prefixes
      }
    }
  }
}
```

---

# ================================

# ğŸ“ modules/artifactregistry/variables.tf

# ================================

```hcl
variable "project_id" {
  type        = string
  description = "Project ID"
}

variable "repositories" {
  type = map(object({
    location    = string
    format      = string
    description = string
    labels      = map(string)

    cleanup = object({
      enabled               = bool
      policy_id             = string
      action                = string
      older_than            = string
      tag_state             = string
      tag_prefixes          = list(string)
      package_name_prefixes = list(string)
    })
  }))
}
```

---

# ================================

# ğŸ“ modules/artifactregistry/outputs.tf

# ================================

```hcl
output "repository_names" {
  value = keys(google_artifact_registry_repository.this)
}
```

---

# ================================

# ğŸ“ Root main.tf

# ================================

Add this block below your other modules:

```hcl
module "artifactregistry" {
  source = "./modules/artifactregistry"

  project_id   = var.project_id
  repositories = var.artifact_repositories
}
```

---

# ================================

# ğŸ“ Root variables.tf

# ================================

Add:

```hcl
variable "artifact_repositories" {
  type = map(object({
    location    = string
    format      = string
    description = string
    labels      = map(string)

    cleanup = object({
      enabled               = bool
      policy_id             = string
      action                = string
      older_than            = string
      tag_state             = string
      tag_prefixes          = list(string)
      package_name_prefixes = list(string)
    })
  }))
}
```

---

# ================================

# ğŸ“ tfvars/mics-hcb-dev.tfvars

# ================================

Add:

```hcl
artifact_repositories = {

  "dev-mics-docker-repo" = {
    location    = "us-east4"
    format      = "DOCKER"
    description = "Docker repository for dev environment"

    labels = {
      environment = "dev"
      managed-by  = "terraform"
    }

    cleanup = {
      enabled               = true
      policy_id             = "delete-old-images"
      action                = "DELETE"
      older_than            = "30d"
      tag_state             = "ANY"
      tag_prefixes          = []
      package_name_prefixes = []
    }
  }
}
```

---

# ğŸ¯ What This Creates

When you run:

```bash
terraform plan -var-file=tfvars/mics-hcb-dev.tfvars
```

It will create:

Repository:

```
dev-mics-docker-repo
```

With:

* Format: DOCKER
* Region: us-east4
* Cleanup policy: delete images older than 30 days
* Labels applied

---

# ğŸ”¥ What You Can Customize

In tfvars, you can change:

| Field                 | Example                 |
| --------------------- | ----------------------- |
| format                | DOCKER / MAVEN / PYTHON |
| cleanup older_than    | 7d / 14d / 30d          |
| tag_state             | ANY / TAGGED / UNTAGGED |
| tag_prefixes          | ["release"]             |
| package_name_prefixes | ["app"]                 |

---

# ğŸš€ Enterprise Best Practice Youâ€™re Now Using

âœ” Modular
âœ” Environment driven
âœ” Dynamic for_each
âœ” Cleanup automated
âœ” No hardcoding
âœ” Matches your GCS & PubSub style

---

# âš ï¸ Role Reminder

Infra SA must have:

```
roles/artifactregistry.admin
```

You already have that âœ…

---

# ğŸ¯ Next Logical Step

Now that you have:

* GCS module âœ…
* PubSub module âœ…
* Artifact Registry module âœ…

Next in your story:

```
secretmanager
vertex-ai (API enable)
dataform
dataplex
```

Which one do you want next?
